<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Members only</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <div class="wrapper">
      <%- include('header') %>
      <main>
        <section class="posts">
          <% if(locals.user) { %>
          <form action="/new" method="post" class="post-form">
            <label for="postContent">New post</label>
            <textarea
              name="postContent"
              id="postContent"
              maxlength="255"
              required
            ></textarea>
            <button type="submit">Post</button>
          </form>

          <%- include("partials/errors.ejs") %> <% posts.forEach(function(post)
          { %>
          <article class="post">
            <% if(locals.user.member){ %>
            <h3><%= `${post.first_name} ${post.last_name}`%></h3>
            <% } else {%>
            <h3>[REDACTED]</h3>
            <% } %>
            <p><%= post.content %></p>
            <% if(locals.user.member){ %>
            <p><%= `Posted on: ${post.post_date.toLocaleString()}`%></p>
            <% } else {%>
            <p>Posted on: [REDACTED]</p>
            <% } %>
          </article>
          <% }); %>
        </section>
        <%} else {%>
        <p class="not-logged-in-message">
          You must be create an account and log in to see posts. Only users with
          membership status can see post authors and dates.
        </p>
        <% } %>
      </main>
      <%- include('footer') %>
    </div>
  </body>
</html>
